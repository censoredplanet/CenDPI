{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "type": "object",
    "properties": {
      "interface": {
        "type": "string",
        "description": "Network interface name"
      },
      "pcapPath": {
        "type": "string",
        "description": "Path to pcap file"
      },
      "bpf": {
        "type": "string",
        "description": "Berkeley Packet Filter (BPF) to apply"
      },
      "message": {
        "type": "object",
        "description": "Optional higher-layer message to be fragmented/segmented",
        "properties": {
          "dataHex": {
            "type": "string",
            "pattern": "^[0-9A-Fa-f]+$",
            "description": "Hex-encoded data (raw message)."
          },
          "tcp": {
            "type": "object",
            "properties": {
              "srcPort": {
                "type": "integer",
                "minimum": 0,
                "maximum": 65535
              },
              "dstPort": {
                "type": "integer",
                "minimum": 0,
                "maximum": 65535,
                "default": 80
              },
              "window": {
                "type": "integer",
                "minimum": 0,
                "maximum": 65535,
                "default": 65535
              },
              "seqRelativeToInitial": {
                "type": "integer",
                "default": 0
              },
              "seqRelativeToExpected": {
                "type": "integer",
                "default": 0
              },
              "ackRelativeToExpected": {
                "type": "integer",
                "default": 0
              },
              "flags": {
                "type": "object",
                "properties": {
                  "syn": {"type":"boolean","default":false},
                  "ack": {"type":"boolean","default":false},
                  "psh": {"type":"boolean","default":false},
                  "fin": {"type":"boolean","default":false},
                  "rst": {"type":"boolean","default":false},
                  "urg": {"type":"boolean","default":false},
                  "ece": {"type":"boolean","default":false}
                }
              },
              "data": {
                "type": "string",
                "pattern": "^[A-Za-z0-9+/]*={0,2}$",
                "description": "Base64-encoded data for the TCP segment payload."
              },
              "tcpOptions": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "tcpOptionType": {"type":"integer"},
                    "tcpOptionLength": {"type":"integer","minimum":0},
                    "tcpOptionData": {
                      "type":"string",
                      "pattern":"^[0-9A-Fa-f]*$"
                    }
                  },
                  "required": ["tcpOptionType"],
                  "additionalProperties": false
                }
              }
            },
            "required": ["srcPort","dstPort","window"],
            "additionalProperties": false
          }
        },
        "oneOf": [
          {"required": ["dataHex"]},
          {"required": ["tcp"]}
        ],
        "additionalProperties": false
      },
      "packets": {
        "type": "array",
        "items": {
          "type": "object",
          "properties": {
            "ethernet": {
              "type": "object",
              "properties": {
                "srcMac": {
                  "type": "string",
                  "pattern": "^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$"
                },
                "dstMac": {
                  "type": "string",
                  "pattern": "^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$"
                }
              },
              "required": ["srcMac", "dstMac"],
              "additionalProperties": false
            },
            "ip": {
              "type": "object",
              "properties": {
                "srcIp": {"type":"string","format":"ipv4"},
                "dstIp": {"type":"string","format":"ipv4"},
                "tos": {"type":"integer","minimum":0,"maximum":255,"default":0},
                "ttl": {"type":"integer","minimum":0,"maximum":255,"default":64},
                "id": {"type":"integer","minimum":0,"maximum":65535,"default":0},
                "fragmentOffset": {
                  "type":"integer",
                  "minimum":0,
                  "maximum":65535,
                  "default":0,
                  "description": "offset used in IP header, in 8-byte units"
                },
                "moreFragments": {
                  "type": "boolean",
                  "default": false,
                  "description": "Set true if more fragments follow"
                },
                "messageOffset": {
                  "type": "integer",
                  "minimum": 0,
                  "description": "If taking payload from Message, offset in 8-byte units"
                },
                "messageLength": {
                  "type": "integer",
                  "minimum": 1,
                  "description": "If taking payload from Message, length of the fragment to extract"
                }
              },
              "required": ["srcIp", "dstIp", "ttl"],
              "additionalProperties": false
            },
            "tcp": {
              "type": "object",
              "properties": {
                "srcPort": {"type":"integer","minimum":0,"maximum":65535},
                "dstPort": {"type":"integer","minimum":0,"maximum":65535,"default":80},
                "window": {"type":"integer","minimum":0,"maximum":65535,"default":65535},
                "seq": {
                  "type": "integer",
                  "default": 0
                },
                "ack": {
                  "type": "integer",
                  "default": 0
                },
                "flags": {
                  "type": "object",
                  "properties": {
                    "syn": {"type":"boolean","default":false},
                    "ack": {"type":"boolean","default":false},
                    "psh": {"type":"boolean","default":false},
                    "fin": {"type":"boolean","default":false},
                    "rst": {"type":"boolean","default":false},
                    "urg": {"type":"boolean","default":false},
                    "ece": {"type":"boolean","default":false}
                  }
                },
                "data": {
                  "type": "string",
                  "pattern": "^[A-Za-z0-9+/]*={0,2}$",
                  "description": "Base64-encoded data for this segment if not using segmentOffset/segmentLength"
                },
                "tcpOptions": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "tcpOptionType": {"type":"integer"},
                      "tcpOptionLength": {"type":"integer","minimum":0},
                      "tcpOptionData": {
                        "type":"string",
                        "pattern":"^[0-9A-Fa-f]*$"
                      }
                    },
                    "required": ["tcpOptionType"],
                    "additionalProperties": false
                  }
                },
                "messageOffset": {
                  "type": "integer",
                  "minimum": 0,
                  "description": "If taking payload from Message, offset in 8-byte units"
                },
                "messageLength": {
                  "type": "integer",
                  "minimum": 1,
                  "description": "If taking payload from Message, length of the fragment to extract"
                }
              },
              "required": ["srcPort","dstPort","window"],
              "additionalProperties": false
            },
            "delay": {
              "type": "integer",
              "description": "Seconds to wait for any response packets",
              "default": 0
            }
          },
          "required": ["ethernet", "ip"],
          "additionalProperties": false
        }
      }
    },
    "required": ["interface", "pcapPath", "bpf"],
    "additionalProperties": false
  }
  